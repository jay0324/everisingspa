import{aq as d,ar as i,as as o,at as r,au as n}from"./index.e0359fcf.js";import{api as a}from"./axios.b71c7ddf.js";const u=d("cart",{state:()=>({store:{},products:[{sn:"000001",name:"S-300HB",description:"XXXXXX",price:15820,stockQty:2,requireQty:0,remainQty:1,state:1,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000001",inList:!1}},{sn:"000002",name:"S-300HB",description:"XXXXXX",price:33930,stockQty:1,requireQty:0,remainQty:1,state:0,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000002",inList:!1}},{sn:"000003",name:"S-300HB",description:"XXXXXX",price:33330,stockQty:1,requireQty:0,remainQty:1,state:1,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000003",inList:!1}},{sn:"000004",name:"S-300HB",description:"XXXXXX",price:15260,stockQty:1,requireQty:0,remainQty:1,state:0,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000004",inList:!1}},{sn:"000005",name:"S-300HB",description:"XXXXXX",price:15260,stockQty:1,requireQty:0,remainQty:1,state:0,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000005",inList:!1}}],lists:[],total:{qty:0,price:0},productFilter:{warehouses:null,search:null},productOptions:{state:{0:"\u5F85\u5831\u50F9",1:"\u53D6\u6D88",2:"\u5F85\u5BE9\u6838",3:"\u9810\u5B9A\u4E2D"},type:{0:"\u9810\u5B9A\u8A02\u55AE",1:"\u8A62\u50F9\u8A02\u55AE",2:"\u9700\u6C42\u8A02\u55AE"},location:{0:"\u6B50\u6D32\u5009\u5EAB",1:"\u53F0\u7063\u5009\u5EAB",2:"\u5176\u4ED6\u5009\u5EAB"},productState:{available:"\u6709\u5EAB\u5B58",reserved:"\u5DF2\u9810\u5B9A"}},orderHistory:[]}),getters:{countList(){return this.lists.length},locationOption:e=>{let t=[];for(let s in e.productOptions.location)t.push({label:e.productOptions.location[s],value:s});return t},typeOption:e=>{let t=[];for(let s in e.productOptions.location)t.push({label:e.productOptions.location[s],value:s});return t}},actions:{init(){this.initOrderHistory(),this.initStore()},async getProductList(){let e="/api/v1/products";this.productFilter.warehouses&&!this.productFilter.search&&(e+=`?warehouses=${this.productFilter.warehouses.value}`),!this.productFilter.warehouses&&this.productFilter.search&&(e+=`?search=${this.productFilter.search}`),this.productFilter.warehouses&&this.productFilter.search&&(e+=`?warehouses=${this.productFilter.search}&search=${this.productFilter.search}`),await this.connectStore("product",e).then(()=>{if(this.store.product.length>0){this.products=[];for(let t of this.store.product)this.products.push({sn:t.sn,sn_id:t.sn_id,name:t.product_name,description:t.product_description,price:t.price,stockQty:t.product_qty,state:t.state,releaseDate:t.release_date,arriveDate:t.scheduled_date,type:t.type,stock:{id:t.warehouse_id,name:t.warehouse_name},method:{sn_id:t.sn_id,inList:!1}})}return this.initCartLists()}).then(t=>{this.initProductList()})},async initStore(){await this.connectStore("stock","/api/v1/warehouses").then(()=>{if(this.store.stock.length>0){this.productOptions.location={};for(let e of this.store.stock)this.productOptions.location[e.id]=e.name}}),await this.getProductList()},async connectStore(e,t){try{i.show(),await a.get(t).then(s=>{i.hide(),s.status===200&&s.data.error?o.create({title:"error",message:"error"}):this.store[e]=s.data.data})}catch(s){if(s)throw s}},async initCartLists(){await this.connectStore("cart","/api/v1/get_cart").then(e=>{if(this.store.cart.length>0){this.lists=[];for(let t of this.store.cart)this.lists.push({sn_id:t.lot_id,sn:t.lot_name,pid:t.product_id,name:t.product_name,description:t.product_description,price:t.price_unit,amount:t.product_qty})}})},initOrderHistory(){this.orderHistory=this.initStorage("order-history",this.orderHistory)},initStorage(e,t){return this.checkStorage(e,t),JSON.parse(r.getItem(e))},checkStorage(e,t){r.getItem(e)===null&&r.set(e,JSON.stringify(t))},updateList(e){this.lists=this.lists.filter(s=>s.sn_id!==e);let t=this.products.find(s=>s.sn_id===e);this.lists.push({sn_id:e,sn:t.sn,pid:t.product_id,amount:1,name:t.name,description:t.description,price:t.price}),console.log(e),this.products.map(s=>{s.sn_id===e&&(s.method.inList=!0)}),this.addCartFromStore(e),this.updateTotal()},removeItem(e){this.lists=this.lists.filter(t=>t.sn_id!==e),this.products.map(t=>{t.sn_id===e&&(t.method.inList=!1)}),this.removeCartFromStore(e),this.updateTotal()},async addCartFromStore(e){try{i.show(),await a.post("/api/v1/add_cart",{sn_id:e}).then(t=>{i.hide(),console.log(t),t.status===200&&t.data.error?o.create({title:"error",message:t.data.error.message}):n.create({message:"\u5546\u54C1\u5DF2\u52A0\u5165\u8CFC\u7269\u8ECA",color:"blue"})})}catch(t){if(t)throw t}},async removeCartFromStore(e){try{i.show(),await a.post("/api/v1/remove_cart",{sn_id:e}).then(t=>{i.hide(),t.status===200&&t.data.error?o.create({title:"error",message:t.data.error.message}):n.create({message:"\u5546\u54C1\u5DF2\u5F9E\u8CFC\u7269\u8ECA\u4E2D\u79FB\u9664\u6210\u529F",color:"green"})})}catch(t){if(t)throw t}},increaseAmount(e){this.lists.map(t=>{t.sn===e.sn&&t.amount++}),this.updateTotal()},decreaseAmount(e){this.lists.map(s=>{s.sn===e.sn&&s.amount--});let t=this.lists.find(s=>s.amount===0);t&&this.removeItem(t.name),this.updateTotal()},updateTotal(){let e={qty:0,price:0};for(let t of this.lists)e.qty+=t.amount,e.price+=t.amount*t.price;this.total=e,r.set("products",JSON.stringify(this.products))},initProductList(){this.checkStorage("products",this.products);let e=[];this.products.map(t=>{let s=this.lists.find(c=>c.sn===t.sn);s&&(t.method.inList=!0,e.push(s))}),this.lists=e,this.updateTotal()},availableAmount(e){let t=this.products.find(s=>s.sn===e);return t?t.stockQty:0},arriveDate(e){let t=this.products.find(s=>s.sn===e);return t?this.formateDate(t.arriveDate):"--"},formateDate(e){return e===void 0||e===!1?"--":e},clearLists(){this.lists=[],this.products.map(e=>e.method.inList=!1),this.updateTotal()},updateOrderStorage(){r.set("order-history",JSON.stringify(this.orderHistory))},saveOrder(e){return this.orderHistory.push(e),this.updateOrderStorage(),this.clearLists(),!0},cancelOrder(e){this.orderHistory.map(t=>{t.no===e&&(t.state=1)}),this.updateOrderStorage()},updateOrder(e,t){this.orderHistory.map(s=>{s.no===e&&(s=t)}),this.updateOrderStorage()},removeStorage(){r.remove("cart"),r.remove("products"),r.remove("order-history")}}});export{u};
