import{m as M,r as q,ak as E,aX as L,aY as U,o as I,h as H,n as Y,g as z,aD as j,O as Q,U as G,ag as K,bd as W,be as X,ax as J,x as m,y as S,z as T,ay as g,l as c,Q as p,A as t,B,C as y,F as R,az as A,G as Z,aG as V,aF as $,bf as ee}from"./index.becb7b7f.js";import{Q as te}from"./QMarkupTable.5ecf006c.js";import{Q as se}from"./QBanner.891ad35d.js";import{Q as oe}from"./QPage.1a56325f.js";import{u as re,d as ae}from"./cart.e2d969af.js";import{u as ne}from"./axios.0f3454b4.js";import{u as le}from"./preference.03bb9f57.js";import{_ as ie}from"./plugin-vue_export-helper.21dcd24c.js";var ce=M({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(s,{slots:a,emit:x}){const f=z(),n=q(null);let l=0;const e=[];function v(o){const h=typeof o=="boolean"?o:s.noErrorFocus!==!0,b=++l,P=(r,i)=>{x(`validation${r===!0?"Success":"Error"}`,i)},N=r=>{const i=r.validate();return typeof i.then=="function"?i.then(u=>({valid:u,comp:r}),u=>({valid:!1,comp:r,err:u})):Promise.resolve({valid:i,comp:r})};return(s.greedy===!0?Promise.all(e.map(N)).then(r=>r.filter(i=>i.valid!==!0)):e.reduce((r,i)=>r.then(()=>N(i).then(u=>{if(u.valid===!1)return Promise.reject(u)})),Promise.resolve()).catch(r=>[r])).then(r=>{if(r===void 0||r.length===0)return b===l&&P(!0),!0;if(b===l){const{comp:i,err:u}=r[0];if(u!==void 0&&console.error(u),P(!1,i),h===!0){const F=r.find(({comp:O})=>typeof O.focus=="function"&&j(O.$)===!1);F!==void 0&&F.comp.focus()}}return!1})}function C(){l++,e.forEach(o=>{typeof o.resetValidation=="function"&&o.resetValidation()})}function k(o){o!==void 0&&Q(o);const h=l+1;v().then(b=>{h===l&&b===!0&&(s.onSubmit!==void 0?x("submit",o):o!==void 0&&o.target!==void 0&&typeof o.target.submit=="function"&&o.target.submit())})}function w(o){o!==void 0&&Q(o),x("reset"),G(()=>{C(),s.autofocus===!0&&s.noResetFocus!==!0&&_()})}function _(){K(()=>{if(n.value===null)return;const o=n.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||n.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||n.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(n.value.querySelectorAll("[tabindex]"),h=>h.tabIndex!==-1);o!=null&&o.focus({preventScroll:!0})})}E(W,{bindComponent(o){e.push(o)},unbindComponent(o){const h=e.indexOf(o);h!==-1&&e.splice(h,1)}});let D=!1;return L(()=>{D=!0}),U(()=>{D===!0&&s.autofocus===!0&&_()}),I(()=>{s.autofocus===!0&&_()}),Object.assign(f.proxy,{validate:v,resetValidation:C,submit:k,reset:w,focus:_,getValidationComponents:()=>e}),()=>H("form",{class:"q-form",ref:n,onSubmit:k,onReset:w},Y(a.default))}});const d=re(),{lists:de,total:ue}=X(d);ne();const me=le(),fe={name:"OrderListPage",setup(){return me.loaderTrigger("pageLoader"),{type:q("inquiry"),cart:d,lists:de,total:ue}},data(){return{orderType:"",message:"",contactName:q(null),contactTel:q(null),success:!1}},mounted(){setTimeout(()=>{d.initCartLists(),this.orderType=d.defaultOrderType},500)},methods:{availableAmount(s){return d.availableAmount(s)},arriveDate(s){return d.arriveDate(s)},onReset(){this.$refs.myForm.resetValidation(),this.reset(),d.clearLists()},onSubmit(){this.$refs.myForm.validate().then(s=>{if(s)return this.submitOrder()}).then(s=>{this.success=!0,J.create({message:"Order Created",color:"blue"})})},reset(){this.orderType=d.defaultOrderType,this.message="",this.contactName="",this.contactTel=""},submitOrder(){let s=`${ae.formatDate(Date.now(),"YYYYMMDDHHmmss")}`;return d.saveOrder({no:s,state:0,type:this.orderType,location:1,contact:`${this.contactName}/${this.contactTel}`,method:s,date:{order:this.getTimestamp()},contactDetail:{name:this.contactName,tel:this.contactTel,message:this.message},order:d.lists})},getTimestamp(){return Math.round(+new Date/1e3)},checkPrice(s){return s?`USD$${s}`:"--"},errorMessages(){this.$refs.contact_name.validate(),this.$refs.contact_phone.validate()},checkSn(s){return s?`#${s}`:"--"}}},he={key:0},ye=t("h3",null,"Success",-1),pe={key:1,class:"full-width",style:{"max-width":"1200px"}},ve=t("h2",null,"Order List",-1),ge={class:"text-center flex flex-center q-my-xl"},xe={class:"q-gutter-md full-width text-left"},_e=t("strong",{class:"q-pa-sm"},"Warehouse:",-1),be=t("strong",{class:"q-pa-sm"},"Type:",-1),Se=t("thead",null,[t("tr",null,[t("th",{class:"text-left",width:"100"},"SN"),t("th",{class:"text-left",width:"200"},"Name"),t("th",{class:"text-left"},"description"),t("th",{class:"text-right",width:"150"},"Price (USD)"),t("th",{class:"text-right",width:"150"},"Arrival Date"),t("th",{class:"text-right",width:"100"},"Qty."),t("th",{class:"text-right",width:"20"},"Delete")])],-1),Te={class:"text-left"},qe={class:"text-left"},Ve={class:"text-left"},Ce=["innerHTML"],ke={class:"text-right"},we={class:"text-right"},De={class:"text-right"},Pe={class:"text-right"},Ne=t("div",{class:"q-pa-md"}," No products have been added yet. Please select a product to add. ",-1),Fe={class:"text-center flex flex-center q-my-xl"},Oe={class:"q-pa-md flex"},Qe=t("strong",{class:"q-pa-sm"},"Type:",-1),Be={class:"q-gutter-sm"},Re={class:"row q-gutter-md q-my-md"};function Ae(s,a,x,f,n,l){return m(),S(oe,{padding:"",class:"flex justify-center items-center"},{default:T(()=>[n.success?(m(),g("div",he,[ye,c(p,{to:"order_history",label:"Go to Order History"})])):(m(),g("div",pe,[ve,t("div",ge,[t("div",xe,[_e,B(" "+y(f.cart.warehouse_name)+" ",1),be,B(" "+y(f.cart.warehouse_type),1)])]),f.cart.lists.length>0?(m(),S(te,{key:0,bordered:"",separator:"cell"},{default:T(()=>[Se,t("tbody",null,[(m(!0),g(R,null,A(f.lists,e=>(m(),g("tr",{key:e},[t("td",Te,y(l.checkSn(e.sn)),1),t("td",qe,y(e.name),1),t("td",Ve,[t("div",{innerHTML:e.description},null,8,Ce)]),t("td",ke,y(l.checkPrice(e.price)),1),t("td",we,y(l.arriveDate(e.sn)),1),t("td",De,y(e.amount),1),t("td",Pe,[c(p,{color:"grey",round:"",icon:"delete",onClick:$(v=>f.cart.removeItem(e.id),["prevent"])},null,8,["onClick"])])]))),128))])]),_:1})):(m(),S(se,{key:1,rounded:"",class:"bg-red text-white text-center"},{default:T(()=>[Ne,c(p,{color:"primary",to:"/products",label:"choose products"})]),_:1})),c(Z,{color:"primary",class:"q-mt-xl"}),t("div",Fe,[c(ce,{ref:"myForm",class:"q-gutter-md full-width text-left",onSubmit:a[4]||(a[4]=e=>l.onSubmit()),onReset:a[5]||(a[5]=e=>l.onReset()),onValidationError:a[6]||(a[6]=e=>l.errorMessages())},{default:T(()=>[t("div",Oe,[Qe,t("div",null,[t("div",Be,[(m(!0),g(R,null,A(f.cart.typeOption,e=>(m(),S(ee,{modelValue:n.orderType,"onUpdate:modelValue":a[0]||(a[0]=v=>n.orderType=v),val:e.value,label:e.label,key:e},null,8,["modelValue","val","label"]))),128))])])]),c(V,{ref:"contact_name",outlined:"",modelValue:n.contactName,"onUpdate:modelValue":a[1]||(a[1]=e=>n.contactName=e),label:"Contact Name:","lazy-rules":"",rules:[e=>e&&e.length>0||"Required"]},null,8,["modelValue","rules"]),c(V,{ref:"contact_phone",outlined:"",modelValue:n.contactTel,"onUpdate:modelValue":a[2]||(a[2]=e=>n.contactTel=e),label:"Contact Phone:","lazy-rules":"",rules:[e=>e&&e.length>0||"Required"]},null,8,["modelValue","rules"]),c(V,{modelValue:n.message,"onUpdate:modelValue":a[3]||(a[3]=e=>n.message=e),outlined:"",label:"Note:",type:"textarea"},null,8,["modelValue"]),t("div",Re,[c(p,{class:"col",label:"Clear Cart",color:"grey",type:"reset"}),c(p,{class:"col",label:"Choose Products",color:"teal",to:"products"}),c(p,{class:"col",label:"Submit",color:"blue",type:"submit"})])]),_:1},512)])]))]),_:1})}var Ge=ie(fe,[["render",Ae]]);export{Ge as default};
