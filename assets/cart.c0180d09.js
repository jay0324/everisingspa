import{aq as a,ar as r,as as n,at as i}from"./index.bafb7138.js";import{api as d}from"./axios.53fd7b09.js";const h=a("cart",{state:()=>({store:{},products:[{sn:"000001",name:"S-300HB",description:"XXXXXX",price:15820,stockQty:2,requireQty:0,remainQty:1,state:1,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000001",inList:!1}},{sn:"000002",name:"S-300HB",description:"XXXXXX",price:33930,stockQty:1,requireQty:0,remainQty:1,state:0,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000002",inList:!1}},{sn:"000003",name:"S-300HB",description:"XXXXXX",price:33330,stockQty:1,requireQty:0,remainQty:1,state:1,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000003",inList:!1}},{sn:"000004",name:"S-300HB",description:"XXXXXX",price:15260,stockQty:1,requireQty:0,remainQty:1,state:0,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000004",inList:!1}},{sn:"000005",name:"S-300HB",description:"XXXXXX",price:15260,stockQty:1,requireQty:0,remainQty:1,state:0,releaseDate:"",arriveDate:"2024/06/01",method:{sn:"000005",inList:!1}}],lists:[],total:{qty:0,price:0},productOptions:{state:{0:"\u5F85\u5831\u50F9",1:"\u53D6\u6D88",2:"\u5F85\u5BE9\u6838",3:"\u9810\u5B9A\u4E2D"},type:{0:"\u9810\u5B9A\u8A02\u55AE",1:"\u8A62\u50F9\u8A02\u55AE",2:"\u9700\u6C42\u8A02\u55AE"},location:{0:"\u6B50\u6D32\u5009\u5EAB",1:"\u53F0\u7063\u5009\u5EAB",2:"\u5176\u4ED6\u5009\u5EAB"},productState:{available:"\u6709\u5EAB\u5B58",reserved:"\u5DF2\u9810\u5B9A"}},orderHistory:[]}),getters:{countList(){return this.lists.length},locationOption:t=>{let e=[];for(let s in t.productOptions.location)e.push({label:t.productOptions.location[s],value:s});return e},typeOption:t=>{let e=[];for(let s in t.productOptions.location)e.push({label:t.productOptions.location[s],value:s});return e},getProducts:t=>t.products},actions:{init(){this.initOrderHistory(),this.initStore()},async initStore(){await this.connectStore("stock","/api/v1/warehouses").then(()=>{if(this.store.stock.length>0){this.productOptions.location={};for(let t of this.store.stock)this.productOptions.location[t.id]=t.name}}),await this.connectStore("product","/api/v1/products").then(()=>{if(this.store.product.length>0){this.products=[];for(let t of this.store.product)this.products.push({sn:t.sn,name:t.product_name,description:t.product_description,price:t.price,stockQty:t.product_qty,state:t.state,releaseDate:t.release_date,arriveDate:t.scheduled_date,type:t.type,stock:{id:t.warehouse_id,name:t.warehouse_name},method:{sn:t.sn,inList:!1}})}this.initCartLists(),this.initProductList()})},async connectStore(t,e){try{r.show(),await d.get(e).then(s=>{r.hide(),s.status===200&&s.data.error?n.create({title:"error",message:"error"}):this.store[t]=s.data.data})}catch(s){if(s)throw s}},initCartLists(){this.lists=this.initStorage("cart",this.lists)},initOrderHistory(){this.orderHistory=this.initStorage("order-history",this.orderHistory)},initStorage(t,e){return this.checkStorage(t,e),JSON.parse(i.getItem(t))},checkStorage(t,e){i.getItem(t)===null&&i.set(t,JSON.stringify(e))},updateList(t){this.lists=this.lists.filter(s=>s.sn!==t);let e=this.products.find(s=>s.sn===t);this.lists.push({sn:t,amount:1,price:e.price,description:e.description,name:e.name}),this.products.map(s=>{s.sn===t&&(s.method.inList=!0)}),this.updateTotal()},removeItem(t){this.lists=this.lists.filter(e=>e.sn!==t),this.products.map(e=>{e.sn===t&&(e.method.inList=!1)}),this.updateTotal()},increaseAmount(t){this.lists.map(e=>{e.sn===t.sn&&e.amount++}),this.updateTotal()},decreaseAmount(t){this.lists.map(s=>{s.sn===t.sn&&s.amount--});let e=this.lists.find(s=>s.amount===0);e&&this.removeItem(e.name),this.updateTotal()},updateTotal(){let t={qty:0,price:0};for(let e of this.lists)t.qty+=e.amount,t.price+=e.amount*e.price;this.total=t,i.set("cart",JSON.stringify(this.lists)),i.set("products",JSON.stringify(this.products))},initProductList(){this.checkStorage("products",this.products);let t=[];this.products.map(e=>{let s=this.lists.find(o=>o.sn===e.sn);s&&(e.method.inList=!0,t.push(s))}),this.lists=t,this.updateTotal()},availableAmount(t){let e=this.products.find(s=>s.sn===t);return e?e.stockQty:0},arriveDate(t){let e=this.products.find(s=>s.sn===t);return e?this.formateDate(e.arriveDate):"--"},formateDate(t){return t===void 0||t===!1?"--":t},clearLists(){this.lists=[],this.products.map(t=>t.method.inList=!1),this.updateTotal()},updateOrderStorage(){i.set("order-history",JSON.stringify(this.orderHistory))},saveOrder(t){return this.orderHistory.push(t),this.updateOrderStorage(),this.clearLists(),!0},cancelOrder(t){this.orderHistory.map(e=>{e.no===t&&(e.state=1)}),this.updateOrderStorage()},updateOrder(t,e){this.orderHistory.map(s=>{s.no===t&&(s=e)}),this.updateOrderStorage()},removeStorage(){i.remove("cart"),i.remove("products"),i.remove("order-history")}}});export{h as u};
