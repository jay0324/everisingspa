import{k as M,r as q,ag as A,aW as E,aX as I,o as U,h as H,l as j,g as z,aD as Y,L as O,N as G,ac as W,bc as K,bd as X,ax as J,u as m,v as T,x as S,ay as g,j as c,Q as y,y as t,z as R,A as p,F as B,az as L,C as Z,aG as V,aF as $,be as ee}from"./index.637eb394.js";import{Q as te}from"./QMarkupTable.dfbba1ea.js";import{Q as se}from"./QBanner.24d57e0e.js";import{Q as oe}from"./QPage.0f122a5a.js";import{u as re,d as ae}from"./cart.7b6986b9.js";import{u as ne}from"./auth.17262668.js";import{u as le}from"./preference.6981d379.js";import{_ as ie}from"./plugin-vue_export-helper.21dcd24c.js";import"./axios.aa36abe4.js";var ce=M({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(o,{slots:a,emit:x}){const f=z(),n=q(null);let l=0;const e=[];function v(s){const h=typeof s=="boolean"?s:o.noErrorFocus!==!0,b=++l,P=(r,i)=>{x(`validation${r===!0?"Success":"Error"}`,i)},k=r=>{const i=r.validate();return typeof i.then=="function"?i.then(u=>({valid:u,comp:r}),u=>({valid:!1,comp:r,err:u})):Promise.resolve({valid:i,comp:r})};return(o.greedy===!0?Promise.all(e.map(k)).then(r=>r.filter(i=>i.valid!==!0)):e.reduce((r,i)=>r.then(()=>k(i).then(u=>{if(u.valid===!1)return Promise.reject(u)})),Promise.resolve()).catch(r=>[r])).then(r=>{if(r===void 0||r.length===0)return b===l&&P(!0),!0;if(b===l){const{comp:i,err:u}=r[0];if(u!==void 0&&console.error(u),P(!1,i),h===!0){const F=r.find(({comp:Q})=>typeof Q.focus=="function"&&Y(Q.$)===!1);F!==void 0&&F.comp.focus()}}return!1})}function C(){l++,e.forEach(s=>{typeof s.resetValidation=="function"&&s.resetValidation()})}function w(s){s!==void 0&&O(s);const h=l+1;v().then(b=>{h===l&&b===!0&&(o.onSubmit!==void 0?x("submit",s):s!==void 0&&s.target!==void 0&&typeof s.target.submit=="function"&&s.target.submit())})}function D(s){s!==void 0&&O(s),x("reset"),G(()=>{C(),o.autofocus===!0&&o.noResetFocus!==!0&&_()})}function _(){W(()=>{if(n.value===null)return;const s=n.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||n.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||n.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(n.value.querySelectorAll("[tabindex]"),h=>h.tabIndex!==-1);s!=null&&s.focus({preventScroll:!0})})}A(K,{bindComponent(s){e.push(s)},unbindComponent(s){const h=e.indexOf(s);h!==-1&&e.splice(h,1)}});let N=!1;return E(()=>{N=!0}),I(()=>{N===!0&&o.autofocus===!0&&_()}),U(()=>{o.autofocus===!0&&_()}),Object.assign(f.proxy,{validate:v,resetValidation:C,submit:w,reset:D,focus:_,getValidationComponents:()=>e}),()=>H("form",{class:"q-form",ref:n,onSubmit:w,onReset:D},j(a.default))}});const d=re(),{lists:de,total:ue}=X(d);ne();const me=le(),fe={name:"OrderListPage",setup(){return me.loaderTrigger("pageLoader"),{type:q("inquiry"),cart:d,lists:de,total:ue}},data(){return{orderType:"",message:"",contactName:q(null),contactTel:q(null),success:!1}},mounted(){setTimeout(()=>{d.initCartLists(),this.orderType=d.defaultOrderType},500)},methods:{availableAmount(o){return d.availableAmount(o)},arriveDate(o){return d.arriveDate(o)},onReset(){this.$refs.myForm.resetValidation(),this.reset(),d.clearLists()},onSubmit(){this.$refs.myForm.validate().then(o=>{if(o)return this.submitOrder()}).then(o=>{this.success=!0,J.create({message:"Order Created",color:"blue"})})},reset(){this.orderType=d.defaultOrderType,this.message="",this.contactName="",this.contactTel=""},submitOrder(){let o=`${ae.formatDate(Date.now(),"YYYYMMDDHHmmss")}`;return d.saveOrder({no:o,state:0,type:this.orderType,location:1,contact:`${this.contactName}/${this.contactTel}`,method:o,date:{order:this.getTimestamp()},contactDetail:{name:this.contactName,tel:this.contactTel,message:this.message},order:d.lists})},getTimestamp(){return Math.round(+new Date/1e3)},checkPrice(o){return o?`USD$${o}`:"--"},errorMessages(){this.$refs.contact_name.validate(),this.$refs.contact_phone.validate()}}},he={key:0},pe=t("h3",null,"Success",-1),ye={key:1,class:"full-width",style:{"max-width":"1200px"}},ve=t("h2",null,"Order List",-1),ge={class:"text-center flex flex-center q-my-xl"},xe={class:"q-gutter-md full-width text-left"},_e=t("strong",{class:"q-pa-sm"},"Warehouse:",-1),be=t("strong",{class:"q-pa-sm"},"Type:",-1),Te=t("thead",null,[t("tr",null,[t("th",{class:"text-left",width:"100"},"SN"),t("th",{class:"text-left",width:"200"},"Name"),t("th",{class:"text-left"},"description"),t("th",{class:"text-right",width:"150"},"Price (USD)"),t("th",{class:"text-right",width:"150"},"Scheduled Date"),t("th",{class:"text-right",width:"100"},"Qty."),t("th",{class:"text-right",width:"20"},"Delete")])],-1),Se={class:"text-left"},qe={class:"text-left"},Ve={class:"text-left"},Ce=["innerHTML"],we={class:"text-right"},De={class:"text-right"},Ne={class:"text-right"},Pe={class:"text-right"},ke=t("div",{class:"q-pa-md"}," No products have been added yet. Please select a product to add. ",-1),Fe={class:"text-center flex flex-center q-my-xl"},Qe={class:"q-pa-md flex"},Oe=t("strong",{class:"q-pa-sm"},"Type:",-1),Re={class:"q-gutter-sm"},Be={class:"row q-gutter-md q-my-md"};function Le(o,a,x,f,n,l){return m(),T(oe,{padding:"",class:"flex justify-center items-center"},{default:S(()=>[n.success?(m(),g("div",he,[pe,c(y,{to:"order_history",label:"Go to Order History"})])):(m(),g("div",ye,[ve,t("div",ge,[t("div",xe,[_e,R(" "+p(f.cart.warehouse_name)+" ",1),be,R(" "+p(f.cart.warehouse_type),1)])]),f.cart.lists.length>0?(m(),T(te,{key:0,bordered:"",separator:"cell"},{default:S(()=>[Te,t("tbody",null,[(m(!0),g(B,null,L(f.lists,e=>(m(),g("tr",{key:e},[t("td",Se,"#"+p(e.sn),1),t("td",qe,p(e.name),1),t("td",Ve,[t("div",{innerHTML:e.description},null,8,Ce)]),t("td",we,p(l.checkPrice(e.price)),1),t("td",De,p(l.arriveDate(e.sn)),1),t("td",Ne,p(e.amount),1),t("td",Pe,[c(y,{color:"grey",round:"",icon:"delete",onClick:$(v=>f.cart.removeItem(e.id),["prevent"])},null,8,["onClick"])])]))),128))])]),_:1})):(m(),T(se,{key:1,rounded:"",class:"bg-red text-white text-center"},{default:S(()=>[ke,c(y,{color:"primary",to:"/products",label:"choose products"})]),_:1})),c(Z,{color:"primary",class:"q-mt-xl"}),t("div",Fe,[c(ce,{ref:"myForm",class:"q-gutter-md full-width text-left",onSubmit:a[4]||(a[4]=e=>l.onSubmit()),onReset:a[5]||(a[5]=e=>l.onReset()),onValidationError:a[6]||(a[6]=e=>l.errorMessages())},{default:S(()=>[t("div",Qe,[Oe,t("div",null,[t("div",Re,[(m(!0),g(B,null,L(f.cart.typeOption,e=>(m(),T(ee,{modelValue:n.orderType,"onUpdate:modelValue":a[0]||(a[0]=v=>n.orderType=v),val:e.value,label:e.label,key:e},null,8,["modelValue","val","label"]))),128))])])]),c(V,{ref:"contact_name",outlined:"",modelValue:n.contactName,"onUpdate:modelValue":a[1]||(a[1]=e=>n.contactName=e),label:"Contact Name:","lazy-rules":"",rules:[e=>e&&e.length>0||"Required"]},null,8,["modelValue","rules"]),c(V,{ref:"contact_phone",outlined:"",modelValue:n.contactTel,"onUpdate:modelValue":a[2]||(a[2]=e=>n.contactTel=e),label:"Contact Phone:","lazy-rules":"",rules:[e=>e&&e.length>0||"Required"]},null,8,["modelValue","rules"]),c(V,{modelValue:n.message,"onUpdate:modelValue":a[3]||(a[3]=e=>n.message=e),outlined:"",label:"Note:",type:"textarea"},null,8,["modelValue"]),t("div",Be,[c(y,{class:"col",label:"Clear Cart",color:"grey",type:"reset"}),c(y,{class:"col",label:"Choose Products",color:"teal",to:"products"}),c(y,{class:"col",label:"Submit",color:"blue",type:"submit"})])]),_:1},512)])]))]),_:1})}var We=ie(fe,[["render",Le]]);export{We as default};
